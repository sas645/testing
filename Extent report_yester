package runner;

import org.openqa.selenium.remote.RemoteWebDriver;
import org.openqa.selenium.chrome.ChromeOptions;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.support.events.EventFiringDecorator;
import org.openqa.selenium.support.events.WebDriverListener;
import org.testng.Assert;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.AfterTest;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.BeforeTest;
import org.testng.annotations.Test;

import com.aventstack.extentreports.ExtentReports;
import com.aventstack.extentreports.ExtentTest;

import utils.EventHandler;
import utils.ExtentManager;

import java.net.URL;
import java.net.MalformedURLException;
import java.time.Duration;

public class TestPage {
    WebDriver driver;
    ExtentReports extent;
    ExtentTest test;

    @BeforeTest
    public void startReport() {
        extent = ExtentManager.getInstance();
    }

    @BeforeMethod
    public void setup() throws MalformedURLException {
        driver = new RemoteWebDriver(new URL("http://localhost:4444"), new ChromeOptions());
        driver.manage().window().maximize();
        driver.manage().timeouts().pageLoadTimeout(Duration.ofSeconds(15));
        driver.manage().timeouts().implicitlyWait(Duration.ofSeconds(15));

        WebDriverListener listener = new EventHandler();
        driver = new EventFiringDecorator<>(listener).decorate(driver);
    }

    @Test
    public void providerLoginNavigationTest() {
        test = extent.createTest("Provider Login Navigation Test");

        driver.get("https://www.rakshatpa.com/");

        // Step 3: Click on "Hospital" in the navbar
        driver.findElement(By.linkText("Hospital")).click();
        test.pass("Clicked on Hospital");

        // Step 4: Click on "Insurer" in the navbar
        driver.findElement(By.linkText("Insurer")).click();
        test.pass("Clicked on Insurer");

        // Step 5: Scroll down and click on "Provider" in the SIGN IN dropdown
        driver.findElement(By.linkText("Sign In")).click(); // Open SIGN IN dropdown
        driver.findElement(By.linkText("Provider")).click(); // Click Provider
        test.pass("Clicked on Provider under SIGN IN");

        // Optionally: Assert a navigation or check URL/element
        boolean isProviderLogin = driver.getPageSource().contains("Provider") ||
                                  driver.getCurrentUrl().toLowerCase().contains("provider");
        Assert.assertTrue(isProviderLogin, "Provider login page not found!");
        test.pass("Provider login page loaded successfully.");
    }

    @AfterMethod
    public void teardown() {
        if (driver != null) {
            driver.quit();
        }
    }

    @AfterTest
    public void endReport() {
        extent.flush();
    }
}
